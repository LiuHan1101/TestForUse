<!-- pages/detail/detail.wxml -->
<view class="detail-page" wx:if="{{!isLoading}}">
  <!-- å–å®¶ä¿¡æ¯ -->
  <view class="seller-info">
    <view class="seller-header" bindtap="onViewPublisherDetail">
      <image 
        class="seller-avatar" 
        src="{{publisherInfo.avatar || '/images/avatar.png'}}" 
      />
      <view class="seller-details">
        <view class="seller-name">
          {{publisherInfo.nickname || 'ä¸Šè´¢åŒå­¦'}}
          <text class="verified-badge" wx:if="{{publisherInfo.isVerified}}">âœ“</text>
        </view>
        <view class="seller-rating">
          <text class="rating-stars">â˜…â˜…â˜…â˜…â˜…</text>
          <text class="rating-score">4.8</text>
        </view>
      </view>
      <view class="seller-college">{{publisherInfo.college || 'æœªçŸ¥å­¦æ ¡'}}</view>
    </view>
  </view>

  <!-- å•†å“ä¿¡æ¯ -->
  <view class="goods-info">
    <!-- ä»·æ ¼å’Œæ”¶è— -->
    <view class="price-section">
      <view class="price">
        <text class="price-unit">Â¥</text>
        <text class="price-value">{{goods.price || 0}}</text>
        <text class="wish-tag" wx:if="{{isWish}}">(æ±‚è´­)</text>
      </view>
      <view class="favorite-btn {{isFavorite ? 'favorited' : ''}}" bindtap="onToggleFavorite">
        <text class="favorite-icon">{{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text class="favorite-text">{{isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
      </view>
    </view>
      <!-- ç¡®ä¿äº¤æ˜“ç±»å‹æ­£ç¡®æ˜¾ç¤º -->
      <view class="transaction-tag {{goods.transactionType}}">
        {{goods.transactionType === 'cash' ? 'ğŸ’°ç°é‡‘' : 
          goods.transactionType === 'swap' ? 'ğŸ”„æ¢ç‰©' : 
          'ğŸ’°ğŸ”„ç°é‡‘/æ¢ç‰©'}}
      </view>


    <!-- å•†å“æè¿° -->
    <view class="description-section">
      <view class="section-title">å•†å“æè¿°</view>
      <view class="goods-description">{{goods.description || 'æš‚æ— æè¿°'}}</view>
    </view>

    <!-- æœŸæœ›æ¢ç‰©ï¼ˆå¦‚æœæ˜¯æ¢ç‰©äº¤æ˜“ä¸”æœ‰å†…å®¹ï¼‰ -->
    <view 
      class="swap-section" 
      wx:if="{{(goods.transactionType === 'swap' || goods.transactionType === 'both') && goods.expectedSwap}}"
    >
      <view class="section-title">{{isWish ? 'å¯æä¾›çš„ç‰©å“' : 'æœŸå¾…æ¢ç‰©'}}</view>
      <view class="expected-swap">{{goods.expectedSwap}}</view>
    </view>

    <!-- å•†å“æ ‡ç­¾ -->
    <view class="tags-section" wx:if="{{goods.tags && goods.tags.length > 0}}">
      <view class="section-title">å•†å“æ ‡ç­¾</view>
      <view class="tags-list">
        <text 
          class="tag" 
          wx:for="{{goods.tags}}" 
          wx:key="*this"
        >
          {{item}}
        </text>
      </view>
    </view>

    <!-- å•†å“å›¾ç‰‡è½®æ’­ -->
    <view class="image-swiper" wx:if="{{goods.images && goods.images.length > 0}}">
      <swiper 
        class="swiper" 
        indicator-dots="{{true}}" 
        autoplay="{{false}}" 
        interval="5000" 
        duration="500"
        bindtap="onPreviewImage"
      >
        <swiper-item wx:for="{{goods.images}}" wx:key="*this">
          <image 
            class="swiper-image" 
            src="{{item}}" 
            mode="aspectFill" 
            data-index="{{index}}"
          />
        </swiper-item>
      </swiper>
    </view>

    <!-- å•†å“ä¿¡æ¯è¡¥å…… -->
    <view class="goods-meta">
            <!-- æ­£ç¡®è°ƒç”¨æ ¼å¼åŒ–å‡½æ•° -->
      <view class="publish-time">
        <text class="meta-text">å‘å¸ƒæ—¶é—´ï¼š{{formatTime(goods.createTime) || 'åˆšåˆš'}}</text>
      </view>

      <view class="view-count">
        <text class="meta-text">æµè§ˆ {{goods.viewCount || 0}} æ¬¡</text>
      </view>
      <view class="goods-status" wx:if="{{goods.status}}">
        <text class="meta-text">çŠ¶æ€ï¼š{{goods.status === 'selling' ? 'å‡ºå”®ä¸­' : 
                               goods.status === 'sold' ? 'å·²å”®å‡º' : 
                               goods.status === 'reserved' ? 'å·²é¢„è®¢' : 'æœªçŸ¥'}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="action-bar">
    <view class="action-left">
      <view class="action-btn chat-btn" bindtap="onChat">
        <text class="btn-icon">ğŸ’¬</text>
        <text class="btn-text">èŠå¤©</text>
      </view>
    </view>
    <view class="action-right">
      <!-- å‡ºç‰©å•†å“ -->
      <block wx:if="{{!isWish}}">
        <view 
          class="action-btn buy-btn" 
          bindtap="onBuy" 
          wx:if="{{goods.transactionType === 'cash' || goods.transactionType === 'both'}}"
        >
          <text class="btn-text">ç«‹å³è´­ä¹°</text>
        </view>
        <view 
          class="action-btn swap-btn" 
          bindtap="onSwap" 
          wx:if="{{goods.transactionType === 'swap' || goods.transactionType === 'both'}}"
        >
          <text class="btn-text">å‘èµ·æ¢ç‰©</text>
        </view>
      </block>
      
      <!-- è®¸æ„¿å•†å“ -->
      <block wx:else>
        <view 
          class="action-btn buy-btn" 
          bindtap="onBuy" 
          wx:if="{{goods.transactionType === 'cash' || goods.transactionType === 'both'}}"
        >
          <text class="btn-text">å®ç°æ„¿æœ›</text>
        </view>
        <view 
          class="action-btn swap-btn" 
          bindtap="onSwap" 
          wx:if="{{goods.transactionType === 'swap' || goods.transactionType === 'both'}}"
        >
          <text class="btn-text">ä»¥ç‰©æ¢ç‰©</text>
        </view>
      </block>
    </view>
  </view>

</view>

<!-- åŠ è½½ä¸­çŠ¶æ€ -->
<view class="loading-container" wx:if="{{isLoading}}">
  <view class="loading-spinner"></view>
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>