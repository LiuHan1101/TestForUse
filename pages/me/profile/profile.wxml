<!-- pages/me/profile/profile.wxml -->
<<<<<<< HEAD
<view class="profile-container">
=======
<view class="profile-container" style="width: 710rpx; display: block; box-sizing: content-box">
>>>>>>> develop2.0-ZRT
  <!-- 主加载状态 -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-content">
      <image src="/images/loading.gif" class="loading-icon"></image>
      <text>加载用户信息...</text>
    </view>
  </view>

  <view wx:else>
    <!-- 头部用户信息模块 -->
    <view class="header-section card">
      <!-- 左边：头像和统计数据 -->
      <view class="left-section">
        <image 
          class="user-avatar" 
          src="{{userInfo.avatar}}" 
          mode="aspectFill"
          binderror="onImageError"
          data-type="avatar">
        </image>
<<<<<<< HEAD
        <view class="user-text-info">
          <view class="user-nickname">{{userInfo.nickname}}</view>
          <view class="user-college">{{userInfo.college || '未设置学院'}}</view>
          <view class="user-stats">
            <text class="stat-item">加入 {{userInfo.joinDays}} 天</text>
            <text class="stat-item">信用 {{userInfo.creditScore}}</text>
=======
        <view class="user-stats">
          <text class="stat-item">加入 {{userInfo.joinDays}} 天</text>
          <text class="stat-item">信用 {{userInfo.creditScore}}</text>
        </view>
      </view>

      <!-- 右边：用户信息 -->
      <view class="right-section">
        <view class="user-nickname">{{userInfo.nickname}}</view>
        <view class="user-college">{{userInfo.college || '未设置学院'}}</view>
        <view class="bio-content">{{userInfo.bio || '暂无简介'}}</view>
        <view class="tags-section">
          <view class="tags-list">
            <text class="tag" wx:for="{{userInfo.tags}}" wx:key="*this">{{item}}</text>
>>>>>>> develop2.0-ZRT
          </view>
        </view>
      </view>

      <!-- 右上角编辑资料按钮 -->
      <button 
        class="edit-btn" 
        bindtap="onEditProfile" 
        wx:if="{{!isViewOtherUser}}" style="width: 147rpx; display: flex; box-sizing: border-box; left: 533rpx; top: 52rpx; position: absolute">
        编辑资料
      </button>
      <!-- 右上角私信按钮 -->
      <button 
        class="message-btn" 
        bindtap="onSendMessage" 
        wx:else
        style="width: 100rpx; display: flex; box-sizing: border-box; left: 533rpx; top: 52rpx; position: absolute">
        私信
      </button>
    </view>

  

  <!-- 评价模块 -->
  <view class="rating-section card">
    <view class="rating-title">用户评价</view>
    <view class="rating-content">
      <!-- 左边评论区域 - 固定70%宽度 -->
      <view class="comment-scroll">
        <scroll-view class="comment-list" scroll-y wx:if="{{comments.length > 0}}">
          <view class="comment-item" wx:for="{{comments}}" wx:key="id">
            <text class="comment-user">{{item.user}}:</text>
            <text class="comment-text">{{item.content}}</text>
          </view>
        </scroll-view>
        <view class="comment-empty" wx:else>
          <text>暂无评价</text>
        </view>
      </view>

<<<<<<< HEAD
    <!-- 个人简介模块 -->
    <view class="bio-section card">
      <view class="section-title">个人简介</view>
      <view class="bio-content">{{userInfo.bio || '暂无简介'}}</view>
      <view class="tags-section">
        <view class="tags-title">个性标签</view>
        <view class="tags-list">
          <text class="tag" wx:for="{{userInfo.tags}}" wx:key="*this">{{item}}</text>
          <text class="tag add-tag" bindtap="onAddTag" wx:if="{{!isViewOtherUser}}">+</text>
        </view>
=======
      <!-- 右边评分区域 - 固定30%宽度，始终显示 -->
      <view class="score-display">
        <view class="score-number">{{ratingScore || 0}}</view>
        <view class="score-total">/5分</view>
        <view class="rating-stars">
          <!-- 根据实际评分显示星星，无评分时显示空心星星 -->
          <text 
            class="star {{index < ratingScore ? 'active' : ''}}" 
            wx:for="{{5}}" 
            wx:key="*this"
          >{{index < ratingScore ? '★' : '☆'}}</text>
        </view>
        <view class="rating-count">{{commentCount}}条评价</view>
>>>>>>> develop2.0-ZRT
      </view>
    </view>
  </view>

<<<<<<< HEAD
=======
    
>>>>>>> develop2.0-ZRT
    <!-- 出物和许愿信息模块 -->
    <view class="goods-section" style="width: 710rpx; display: block; box-sizing: border-box; position: relative; left: 0rpx; top: -1rpx">
      <!-- 标签切换 -->
      <view class="goods-tabs" style="position: relative; left: 0rpx; top: -2rpx">
        <view 
          class="tab {{activeGoodsTab === 'published' ? 'active' : ''}}"
          data-tab="published" 
          bindtap="switchGoodsTab" style="width: 347rpx; display: block; box-sizing: border-box; left: 0rpx; top: 0rpx">
          发布 ({{publishedGoods.length}})
        </view>
        <view 
          class="tab {{activeGoodsTab === 'wish' ? 'active' : ''}}"
          data-tab="wish" 
          bindtap="switchGoodsTab">
          许愿 ({{wishGoods.length}})
        </view>
      </view>

      <!-- 商品列表加载状态 -->
      <view class="loading-state" wx:if="{{activeGoodsTab === 'published' && isLoadingGoods}}">
        <view class="loading-content">
          <image src="/images/loading.gif" class="loading-icon"></image>
          <text>加载商品中...</text>
        </view>
      </view>

      <!-- 愿望列表加载状态 -->
      <view class="loading-state" wx:if="{{activeGoodsTab === 'wish' && isLoadingWishes}}">
        <view class="loading-content">
          <image src="/images/loading.gif" class="loading-icon"></image>
          <text>加载愿望中...</text>
        </view>
      </view>

      <!-- 商品/愿望列表内容 -->
      <view class="goods-list" wx:if="{{!isLoadingGoods && !isLoadingWishes}}">
        <!-- 已发布商品 -->
        <block wx:if="{{activeGoodsTab === 'published'}}">
          <!-- 空状态 -->
          <view class="empty-state" wx:if="{{showEmptyGoods || publishedGoods.length === 0}}">
            <image src="/images/empty-goods.png" class="empty-icon"></image>
            <text class="empty-text">还没有发布商品哦～</text>
          </view>
          
          <!-- 商品列表 -->
          <view 
            class="goods-item" 
            wx:for="{{publishedGoods}}" 
            wx:key="id" 
            data-id="{{item.id}}" 
            data-index="{{index}}"
            bindtap="onGoodsTap">
            <image 
              class="goods-image" 
              src="{{item.image}}" 
              mode="aspectFill" 
              data-index="{{index}}" 
              binderror="onImageError"
              data-type="goods">
            </image>
            <view class="goods-info">
              <view class="goods-header">
                <view class="goods-title">{{item.title}}</view>
                <view class="goods-price"><text wx:if="{{item.price > 0 && item.transactionType !== 'swap'}}">¥{{item.price}}</text></view>
              </view>
              <view class="goods-meta">
                <view class="goods-description" style="position: relative; left: 0rpx; top: -2rpx">{{item.description}}</view>
                <view class="goods-time">{{item.createTime}}</view>
              </view>
              <view class="goods-bottom">
                <view class="goods-tags">
                  <!-- 商品分类标签（绿色） -->
                  <block wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">
                    <text class="goods-tag">{{tag}}</text>
                  </block>
                </view>
                <!-- 交易类型（灰色） -->
                <view class="goods-type">{{item.transactionType === 'cash' ? '现金' : item.transactionType === 'swap' ? '换物' : '均可'}}</view>
              </view>
<<<<<<< HEAD
              <view class="goods-desc">{{item.description}}</view>
=======
>>>>>>> develop2.0-ZRT
            </view>
          </view>
        </block>

        <!-- 许愿列表 -->
        <block wx:if="{{activeGoodsTab === 'wish'}}">
          <!-- 空状态 -->
          <view class="empty-state" wx:if="{{showEmptyWishes || wishGoods.length === 0}}">
            <image src="/images/empty-wish.png" class="empty-icon"></image>
            <text class="empty-text">还没有许愿哦～</text>
          </view>
          
          <!-- 愿望列表 -->
          <view 
            wx:for="{{wishGoods}}" 
            wx:key="id" 
            class="goods-item" 
            data-id="{{item.id}}" 
            data-type="wish"
            bindtap="onGoodsTap">
            <image 
              src="{{item.image}}" 
              class="goods-image" 
              mode="aspectFill"
              data-index="{{index}}"
              data-type="wish"
              binderror="onImageError"></image>
            <view class="goods-info">
              <view class="goods-header">
                <view class="goods-title">{{item.title}}</view>
                <!-- 即使没有价格，也保留这个view占位 -->
                <view class="goods-price">
                  <text wx:if="{{item.price > 0 && item.transactionType !== 'swap'}}">¥{{item.price}}</text>
                </view>
              </view>
              <view class="goods-meta">
                <view class="goods-description" style="position: relative; left: 0rpx; top: -2rpx">{{item.shortDescription}}</view>
                <view class="goods-time">{{item.createTime}}</view>
              </view>
              <view class="goods-bottom">
                <view class="goods-tags">
                  <block wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">
                    <text class="goods-tag">{{tag}}</text>
                  </block>
                </view>
                <view class="goods-type" wx:if="{{item.transactionTypeText}}">{{item.transactionTypeText}}</view>
              </view>
            </view>
          </view>
        </block>
      </view> 
    </view>
  </view>
</view>