<!-- pages/me/profile/profile.wxml -->
<view class="profile-container">
  <!-- å¤´éƒ¨ç”¨æˆ·ä¿¡æ¯æ¨¡å— -->
  <view class="header-section card">
    <view class="user-basic-info">
      <image class="user-avatar" src="{{userInfo.avatar}}" mode="aspectFill"></image>
      <view class="user-text-info">
        <view class="user-nickname">{{userInfo.nickname}}</view>
        <view class="user-college">{{userInfo.college}}</view>
        <view class="user-stats">
          <text class="stat-item">åŠ å…¥ {{userInfo.joinDays}} å¤©</text>
          <text class="stat-item">ä¿¡ç”¨ {{userInfo.creditScore}}</text>
        </view>
      </view>
    </view>
    <button class="message-btn" bindtap="onSendMessage">ç§ä¿¡</button>
  </view>

  <!-- è¯„ä»·æ¨¡å— -->
  <view class="rating-section card">
    <view class="rating-title">ç”¨æˆ·è¯„ä»·</view>
    <view class="rating-content">
      <!-- å·¦è¾¹è¯„è®ºæ»šåŠ¨åŒºåŸŸ (70%) -->
      <view class="comment-scroll">
        <scroll-view class="comment-list" scroll-y>
          <view class="comment-item" wx:for="{{comments}}" wx:key="id">
            <text class="comment-user">{{item.user}}:</text>
            <text class="comment-text">{{item.content}}</text>
          </view>
        </scroll-view>
      </view>
      <!-- å³è¾¹è¯„åˆ†åŒºåŸŸ (30%) -->
      <view class="score-display">
        <view class="score-number">{{ratingScore}}</view>
        <view class="score-total">/5åˆ†</view>
        <view class="rating-stars">
          <text class="star" wx:for="{{5}}" wx:key="*this">â­</text>
        </view>
        <view class="rating-count">{{commentCount}}æ¡è¯„ä»·</view>
      </view>
    </view>
  </view>

  <!-- ä¸ªäººç®€ä»‹æ¨¡å— -->
  <view class="bio-section card">
    <view class="section-title">ä¸ªäººç®€ä»‹</view>
    <view class="bio-content">{{userInfo.bio || 'æ— '}}</view>
    <view class="tags-section">
      <view class="tags-title">ä¸ªæ€§æ ‡ç­¾</view>
      <view class="tags-list">
        <text class="tag" wx:for="{{userInfo.tags}}" wx:key="*this">{{item}}</text>
        <text class="tag add-tag" bindtap="onAddTag">+</text>
      </view>
    </view>
  </view>

  <!-- å‡ºç‰©å’Œè®¸æ„¿ä¿¡æ¯æ¨¡å— -->
  <view class="goods-section">
    <!-- å‡ºç‰©ä¿¡æ¯ -->
    <view class="goods-tabs">
      <view class="tab {{activeGoodsTab === 'published' ? 'active' : ''}}"data-tab="published" bindtap="switchGoodsTab">
        å‘å¸ƒ ({{publishedGoods.length}})
      </view>
      <view class="tab {{activeGoodsTab === 'wish' ? 'active' : ''}}" data-tab="wish" bindtap="switchGoodsTab">
        è®¸æ„¿ ({{wishGoods.length}})
      </view>
    </view>

    <!-- å•†å“åˆ—è¡¨ -->
    <view class="goods-list">
      <block wx:if="{{activeGoodsTab === 'published'}}">
        <view class="goods-item" wx:for="{{publishedGoods}}" wx:key="id" data-id="{{item.id}}" bindtap="onGoodsTap">
          <image class="goods-image" src="{{item.image}}" mode="aspectFill" data-index="{{index}}" binderror="onImageError"></image>
          <view class="goods-info">
            <view class="goods-title">{{item.title}}</view>
            <view class="goods-price">
              <text class="price" wx:if="{{item.price > 0}}">Â¥{{item.price}}</text>
              <text class="swap-tag" wx:if="{{item.transactionType === 'swap' || item.transactionType === 'both'}}">å¯æ¢ç‰©</text>
            </view>
            <view class="goods-desc">{{item.description}}</view>
          </view>
        </view>
        <view class="empty-state" wx:if="{{sellingGoods.length === 0}}">
          <image src="/images/empty-goods.png"></image>
          <text>è¿˜æ²¡æœ‰å‘å¸ƒå•†å“å“¦ï½</text>
        </view>
      </block>

      <block wx:if="{{activeGoodsTab === 'wishes'}}">
        <view class="wish-item" wx:for="{{wishGoods}}" wx:key="id" bindtap="onWishTap" data-id="{{item.id}}">
          <view class="wish-icon">ğŸ¯</view>
          <view class="wish-info">
            <view class="wish-title">{{item.title}}</view>
            <view class="wish-desc">{{item.description}}</view>
            <view class="wish-offer">
              <text wx:if="{{item.maxPrice > 0}}">æ„¿ä»˜ Â¥{{item.maxPrice}}</text>
              <text wx:if="{{item.expectedItem}}">æ„¿æ¢ {{item.expectedItem}}</text>
            </view>
          </view>
        </view>
        <view class="empty-state" wx:if="{{wishGoods.length === 0}}">
          <image src="/images/empty-wish.png"></image>
          <text>è¿˜æ²¡æœ‰è®¸æ„¿å“¦ï½</text>
        </view>
      </block>
    </view>
  </view>
</view>