<!--pages/wishpool/wishpool.wxml-->
<view class="wishpool-page">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <input 
        class="search-input" 
        placeholder="æœç´¢æ„¿æœ›..." 
        bindinput="onSearch"
        value="{{searchValue}}"
      />
      <view class="search-icon">ğŸ”</view>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs-section">
    <view class="tabs">
      <view 
        class="tab {{activeTab === 'all' ? 'active' : ''}}" 
        data-tab="all" 
        bindtap="switchTab"
      >
        å…¨éƒ¨æ„¿æœ›
        <view class="tab-badge" wx:if="{{wishList.length}}">{{wishList.length}}</view>
      </view>
      <view 
        class="tab {{activeTab === 'mine' ? 'active' : ''}}" 
        data-tab="mine" 
        bindtap="switchTab"
      >
        æˆ‘çš„æ„¿æœ›
        <view class="tab-badge" wx:if="{{myWishes.length}}">{{myWishes.length}}</view>
      </view>
    </view>
  </view>

  <!-- æ„¿æœ›åˆ—è¡¨ -->
  <view class="wish-list">
    <block wx:if="{{activeTab === 'all'}}">
      <view 
        class="wish-item {{item.status === 'fulfilled' ? 'fulfilled' : ''}}" 
        wx:for="{{wishList}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="onWishItemTap"
      >
        <view class="wish-header">
          <view class="wish-title">{{item.title}}</view>
          <view class="wish-type {{item.wishType}}">
            {{item.wishType === 'buy' ? 'æ±‚è´­' : 'æ±‚æ¢'}}
          </view>
        </view>
        
        <view class="wish-description">{{item.description}}</view>
        
        <view class="wish-expectation">
          <text class="expect-label">æœŸæœ›ï¼š</text>
          <text class="expect-value">
            {{item.wishType === 'buy' ? 'Â¥' + item.expectedPrice : item.expectedSwap}}
          </text>
        </view>
        
        <view class="wish-footer">
          <view class="user-info">
            <image class="user-avatar" src="{{item.user.avatar}}"></image>
            <text class="user-name">{{item.user.nickname}}</text>
            <text class="user-college">Â· {{item.user.college}}</text>
          </view>
          <view class="wish-meta">
            <text class="match-count" wx:if="{{item.matchCount > 0}}">
              {{item.matchCount}}ä¸ªåŒ¹é…
            </text>
            <text class="create-time">{{item.createTime}}</text>
          </view>
        </view>
        
        <!-- å·²å®ç°æ ‡è¯† -->
        <view class="fulfilled-badge" wx:if="{{item.status === 'fulfilled'}}">ğŸ‰ å·²å®ç°</view>
        
        <!-- åˆ†äº«æŒ‰é’® -->
        <view class="wish-actions" catchtap="onShareWish" data-id="{{item.id}}">
          <text class="share-btn">ğŸ“¤ åˆ†äº«</text>
        </view>
      </view>
    </block>

    <block wx:else>
      <view 
        class="wish-item mine" 
        wx:for="{{myWishes}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="onWishItemTap"
      >
        <view class="wish-header">
          <view class="wish-title">{{item.title}}</view>
          <view class="wish-status {{item.status}}">
            {{item.status === 'pending' ? 'å¾…å®ç°' : 'å·²å®ç°'}}
          </view>
        </view>
        
        <view class="wish-description">{{item.description}}</view>
        
        <view class="wish-expectation">
          <text class="expect-label">æœŸæœ›ï¼š</text>
          <text class="expect-value">
            {{item.wishType === 'buy' ? 'Â¥' + item.expectedPrice : item.expectedSwap}}
          </text>
        </view>
        
        <view class="wish-footer">
          <view class="match-info">
            <text class="match-count" wx:if="{{item.matchCount > 0}}">
              {{item.matchCount}}ä¸ªå•†å“åŒ¹é…
            </text>
            <text class="no-match" wx:else>æš‚æ— åŒ¹é…</text>
          </view>
          <view class="my-wish-actions">
            <text class="action-btn edit" catchtap="onEditWish" data-id="{{item.id}}">ç¼–è¾‘</text>
            <text class="action-btn delete" catchtap="onDeleteWish" data-id="{{item.id}}">åˆ é™¤</text>
          </view>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{getCurrentList().length === 0}}">
      <view class="empty-icon">â­</view>
      <view class="empty-text">æš‚æ— æ„¿æœ›</view>
      <view class="empty-desc">å‘å¸ƒä½ çš„ç¬¬ä¸€ä¸ªæ„¿æœ›å§</view>
    </view>
  </view>

  <!-- å‘å¸ƒæŒ‰é’® -->
  <view class="publish-fab" bindtap="onPublishWish">
    <text class="fab-icon">+</text>
    <text class="fab-text">å‘å¸ƒæ„¿æœ›</text>
  </view>
</view>